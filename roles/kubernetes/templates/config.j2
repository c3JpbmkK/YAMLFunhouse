{% if certificate_key.stdout is defined %}

apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
certificateKey: {{ certificate_key.stdout }}

{% elif ansible_facts['ansible_local']['bootstrap']['kubernetes']['certificate_key'] is defined %}

apiVersion: kubeadm.k8s.io/v1beta3
kind: InitConfiguration
certificateKey: {{ ansible_facts['ansible_local']['bootstrap']['kubernetes']['certificate_key'] }}

{% endif %}
---
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
clusterName: {{ k8s_cluster_name }}
kubernetesVersion: {{ k8s_cluster_version }}
controlPlaneEndpoint: lbinternal.example.com:6443
networking:
  podSubnet: {{ pod_network_cidr }}
  serviceSubnet: {{ service_network_cidr }}
apiServer:
  extraArgs:
    authorization-mode: "Node,RBAC"
#---
#apiVersion: kubeproxy.config.k8s.io/v1alpha1
#kind: KubeProxyConfiguration
#---
#apiVersion: kubeadm.k8s.io/v1beta3
#kind: JoinConfiguration
---
apiVersion: kubelet.config.k8s.io/v1beta1
kind: KubeletConfiguration
rotateCertificates: false
serverTLSBootstrap: true
